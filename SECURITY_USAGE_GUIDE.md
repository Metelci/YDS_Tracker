# üîê StudyPlan Android G√ºvenlik Kullanƒ±m Kƒ±lavuzu

Bu kƒ±lavuz, uygulanan g√ºvenlik bile≈üenlerinin nasƒ±l kullanƒ±lacaƒüƒ±nƒ± detaylƒ± √∂rneklerle a√ßƒ±klamaktadƒ±r.

## **1. SecurityUtils - Temel G√ºvenlik ƒ∞≈ülemleri**

### **1.1 Veri ≈ûifreleme/√á√∂zme**

```kotlin
import com.mtlc.studyplan.utils.SecurityUtils

class UserManager(private val context: Context) {

    // Hassas kullanƒ±cƒ± verilerini ≈üifrele
    fun saveUserCredentials(username: String, password: String) {
        try {
            // Kullanƒ±cƒ± adƒ± ve ≈üifreyi ≈üifrele
            val encryptedUsername = SecurityUtils.encryptString(username)
            val encryptedPassword = SecurityUtils.encryptString(password)

            // SharedPreferences'a kaydet
            val prefs = context.getSharedPreferences("user_data", Context.MODE_PRIVATE)
            prefs.edit()
                .putString("username", encryptedUsername)
                .putString("password", encryptedPassword)
                .apply()

        } catch (e: SecurityException) {
            // ≈ûifreleme hatasƒ± - kullanƒ±cƒ±ya g√∂ster
            showError("Veri ≈üifrelenirken hata olu≈ütu")
        }
    }

    // ≈ûifrelenmi≈ü veriyi oku
    fun getUserCredentials(): Pair<String, String>? {
        val prefs = context.getSharedPreferences("user_data", Context.MODE_PRIVATE)
        val encryptedUsername = prefs.getString("username", null)
        val encryptedPassword = prefs.getString("password", null)

        return if (encryptedUsername != null && encryptedPassword != null) {
            try {
                val username = SecurityUtils.decryptString(encryptedUsername)
                val password = SecurityUtils.decryptString(encryptedPassword)
                Pair(username, password)
            } catch (e: SecurityException) {
                // √á√∂zme hatasƒ±
                null
            }
        } else null
    }
}
```

### **1.2 Input Validation**

```kotlin
import com.mtlc.studyplan.utils.SecurityUtils.InputValidator

class UserInputHandler {

    fun validateAndProcessUserInput(email: String, password: String): ValidationResult {
        val errors = mutableListOf<String>()

        // Email validation
        if (!InputValidator.isValidEmail(email)) {
            errors.add("Ge√ßersiz email formatƒ±")
        }

        // Password validation
        if (!InputValidator.isStrongPassword(password)) {
            errors.add("≈ûifre en az 8 karakter, b√ºy√ºk/k√º√ß√ºk harf, rakam ve √∂zel karakter i√ßermeli")
        }

        // URL validation (eƒüer kullanƒ±cƒ± URL giriyorsa)
        val website = "https://example.com"
        if (!InputValidator.isValidUrl(website)) {
            errors.add("Ge√ßersiz website URL'i")
        }

        return if (errors.isEmpty()) {
            ValidationResult.Success(processSecureInput(email, password))
        } else {
            ValidationResult.Failure(errors)
        }
    }

    private fun processSecureInput(email: String, password: String): String {
        // Input sanitization
        val sanitizedEmail = InputValidator.sanitizeHTMLInput(email)

        // ≈ûifreyi hash'le (asla plain text olarak saklama)
        val passwordHash = SecurityUtils.hashString(password)

        return "Email: $sanitizedEmail, Hash: $passwordHash"
    }
}
```

### **1.3 G√ºvenli Bellek Y√∂netimi**

```kotlin
class SecureMemoryHandler {

    fun processSensitiveData() {
        var sensitiveData: CharArray? = null
        var apiKey: ByteArray? = null

        try {
            // Hassas veriyi i≈üle
            sensitiveData = "very_secret_data".toCharArray()
            apiKey = SecurityUtils.generateSecureRandomBytes(32)

            // Veriyi kullan
            useSensitiveData(sensitiveData, apiKey)

        } finally {
            // Belleƒüi g√ºvenli ≈üekilde temizle
            SecurityUtils.secureWipe(sensitiveData, apiKey)

            // Referanslarƒ± null'a ayarla
            sensitiveData = null
            apiKey = null
        }
    }

    private fun useSensitiveData(data: CharArray, key: ByteArray) {
        // Hassas veriyi kullan (API √ßaƒürƒ±sƒ±, ≈üifreleme vb.)
        println("Processing ${data.size} characters and ${key.size} bytes")
    }
}
```

## **2. AuthenticationManager - Kimlik Doƒürulama**

### **2.1 Biyometrik Kimlik Doƒürulama**

```kotlin
import com.mtlc.studyplan.security.AuthenticationManager

class LoginActivity : ComponentActivity() {

    private lateinit var authManager: AuthenticationManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        authManager = AuthenticationManager(this)

        // Biyometrik destek kontrol√º
        if (authManager.isBiometricAvailable()) {
            showBiometricPrompt()
        } else {
            showPinLogin()
        }
    }

    private fun showBiometricPrompt() {
        authManager.authenticateWithBiometric(
            activity = this,
            title = "StudyPlan'e Giri≈ü",
            subtitle = "Devam etmek i√ßin biyometrik verinizi kullanƒ±n",
            onSuccess = {
                // Ba≈üarƒ±lƒ± giri≈ü - ana ekrana y√∂nlendir
                startActivity(Intent(this, MainActivity::class.java))
                finish()
            },
            onError = { error ->
                // Hata durumunda PIN giri≈üine ge√ß
                showPinLogin()
                Toast.makeText(this, "Biyometrik hata: $error", Toast.LENGTH_SHORT).show()
            }
        )
    }
}
```

### **2.2 PIN ve ≈ûifre Y√∂netimi**

```kotlin
class SecuritySettingsActivity : ComponentActivity() {

    private lateinit var authManager: AuthenticationManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        authManager = AuthenticationManager(this)

        setContent {
            SecuritySettingsScreen()
        }
    }

    @Composable
    fun SecuritySettingsScreen() {
        val context = LocalContext.current
        val coroutineScope = rememberCoroutineScope()

        Column(modifier = Modifier.padding(16.dp)) {

            // PIN ayarlama
            Button(onClick = {
                coroutineScope.launch {
                    val success = authManager.setPin("123456")
                    if (success) {
                        Toast.makeText(context, "PIN ba≈üarƒ±yla ayarlandƒ±", Toast.LENGTH_SHORT).show()
                    } else {
                        Toast.makeText(context, "PIN ayarlanamadƒ±", Toast.LENGTH_SHORT).show()
                    }
                }
            }) {
                Text("PIN Ayarla")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Biyometrik aktifle≈ütirme
            Button(onClick = {
                val success = authManager.enableBiometric()
                if (success) {
                    Toast.makeText(context, "Biyometrik aktifle≈ütirildi", Toast.LENGTH_SHORT).show()
                }
            }) {
                Text("Biyometrik Aktifle≈ütir")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Session durumu
            val sessionValid by authManager.isSessionValid().collectAsState(initial = false)
            Text("Session Durumu: ${if (sessionValid) "Aktif" else "Pasif"}")

            Spacer(modifier = Modifier.height(16.dp))

            // G√ºvenlik istatistikleri
            Button(onClick = {
                val stats = authManager.getSecurityStats()
                // ƒ∞statistikleri g√∂ster
                showSecurityStats(stats)
            }) {
                Text("G√ºvenlik ƒ∞statistikleri")
            }
        }
    }
}
```

## **3. SecureStorageManager - G√ºvenli Veri Saklama**

### **3.1 API Key ve Token Y√∂netimi**

```kotlin
import com.mtlc.studyplan.security.SecureStorageManager

class ApiManager(private val context: Context) {

    private val secureStorage = SecureStorageManager(context)

    suspend fun saveApiCredentials(apiKey: String, refreshToken: String) {
        try {
            // API anahtarƒ±nƒ± g√ºvenli ≈üekilde sakla
            secureStorage.storeApiKey(apiKey)

            // Refresh token'ƒ± da sakla
            secureStorage.storeSecureData("refresh_token", refreshToken)

            SecurityUtils.SecurityLogger.logSecurityEvent("API credentials stored securely")

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "API credentials storage failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
        }
    }

    suspend fun getApiCredentials(): Pair<String?, String?> {
        val apiKey = secureStorage.getApiKey()
        val refreshToken = secureStorage.getSecureData("refresh_token")

        return Pair(apiKey, refreshToken)
    }

    suspend fun makeSecureApiCall(endpoint: String): String? {
        val apiKey = getApiCredentials().first ?: return null

        return try {
            // G√ºvenli API √ßaƒürƒ±sƒ±
            val response = NetworkSecurityManager(context).makeSecureApiCall(
                url = "https://api.example.com/$endpoint",
                method = "GET"
            )

            response.getOrNull()

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "API call failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
            null
        }
    }
}
```

### **3.2 Kullanƒ±cƒ± Verisi Y√∂netimi**

```kotlin
class UserProfileManager(private val context: Context) {

    private val secureStorage = SecureStorageManager(context)

    data class UserProfile(
        val name: String,
        val email: String,
        val phone: String,
        val preferences: Map<String, Any>
    )

    suspend fun saveUserProfile(profile: UserProfile) {
        try {
            // Kullanƒ±cƒ± profilini JSON'a √ßevir
            val profileJson = kotlinx.serialization.json.Json.encodeToString(
                kotlinx.serialization.json.JsonObject.serializer(),
                kotlinx.serialization.json.JsonObject(
                    mapOf(
                        "name" to kotlinx.serialization.json.JsonPrimitive(profile.name),
                        "email" to kotlinx.serialization.json.JsonPrimitive(profile.email),
                        "phone" to kotlinx.serialization.json.JsonPrimitive(profile.phone),
                        "preferences" to kotlinx.serialization.json.Json.encodeToJsonElement(profile.preferences)
                    )
                )
            )

            // ≈ûifrelenmi≈ü ≈üekilde sakla
            secureStorage.storeUserData(profileJson)

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "User profile save failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
        }
    }

    suspend fun getUserProfile(): UserProfile? {
        return try {
            val profileJson = secureStorage.getUserData() ?: return null

            // JSON'dan UserProfile'a √ßevir
            val jsonObject = kotlinx.serialization.json.Json.decodeFromString<
                Map<String, kotlinx.serialization.json.JsonElement>
            >(profileJson)

            UserProfile(
                name = jsonObject["name"]?.jsonPrimitive?.content ?: "",
                email = jsonObject["email"]?.jsonPrimitive?.content ?: "",
                phone = jsonObject["phone"]?.jsonPrimitive?.content ?: "",
                preferences = emptyMap() // Basitle≈ütirilmi≈ü
            )

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "User profile load failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
            null
        }
    }
}
```

## **4. NetworkSecurityManager - Aƒü G√ºvenliƒüi**

### **4.1 G√ºvenli HTTP ƒ∞stemcisi**

```kotlin
import com.mtlc.studyplan.security.NetworkSecurityManager

class NetworkManager(private val context: Context) {

    private val networkSecurity = NetworkSecurityManager(context)

    // G√ºvenli OkHttpClient olu≈ütur
    private val secureClient: OkHttpClient by lazy {
        networkSecurity.createSecureOkHttpClient()
    }

    suspend fun loginUser(email: String, password: String): LoginResult {
        // Rate limiting kontrol√º
        if (!networkSecurity.checkRateLimit()) {
            return LoginResult.Failure("√áok fazla istek g√∂nderildi")
        }

        return try {
            // G√ºvenli API √ßaƒürƒ±sƒ±
            val loginJson = """
                {
                    "email": "${SecurityUtils.InputValidator.sanitizeHTMLInput(email)}",
                    "password": "${SecurityUtils.hashString(password)}"
                }
            """.trimIndent()

            val response = networkSecurity.makeSecureApiCall(
                url = "https://api.studyplan.com/auth/login",
                method = "POST",
                body = loginJson.toRequestBody("application/json".toMediaType())
            )

            when {
                response.isSuccess -> {
                    val responseData = response.getOrNull()
                    // Response'u i≈üle
                    LoginResult.Success(parseLoginResponse(responseData))
                }
                response.isFailure -> {
                    LoginResult.Failure("Giri≈ü ba≈üarƒ±sƒ±z: ${response.exceptionOrNull()?.message}")
                }
                else -> LoginResult.Failure("Bilinmeyen hata")
            }

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "Login API call failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
            LoginResult.Failure("Aƒü hatasƒ±: ${e.message}")
        }
    }

    suspend fun downloadSecureFile(fileUrl: String, destinationPath: String): Boolean {
        return try {
            val result = networkSecurity.downloadSecureFile(fileUrl, destinationPath)
            result.isSuccess
        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "File download failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.ERROR
            )
            false
        }
    }
}
```

### **4.2 Aƒü G√ºvenliƒüi Kontrol√º**

```kotlin
class SecurityMonitor(private val context: Context) {

    private val networkSecurity = NetworkSecurityManager(context)

    fun performSecurityCheck(): SecurityCheckResult {
        val status = networkSecurity.validateNetworkSecurity()

        return SecurityCheckResult(
            isHttpsEnabled = status.isHttpsEnabled,
            isCertificatePinningActive = status.isCertificatePinningEnabled,
            isSSLEnabled = status.isSSLEnabled,
            isRateLimitingActive = status.isRateLimitingEnabled,
            isHttpsWorking = status.isHttpsWorking,
            recommendations = generateRecommendations(status)
        )
    }

    private fun generateRecommendations(status: NetworkSecurityManager.NetworkSecurityStatus): List<String> {
        val recommendations = mutableListOf<String>()

        if (!status.isHttpsEnabled) {
            recommendations.add("HTTPS zorunlu kƒ±lƒ±nmalƒ±")
        }

        if (!status.isCertificatePinningEnabled) {
            recommendations.add("Certificate pinning aktifle≈ütirilmeli")
        }

        if (!status.isRateLimitingEnabled) {
            recommendations.add("Rate limiting uygulanmalƒ±")
        }

        if (!status.isHttpsWorking) {
            recommendations.add("HTTPS baƒülantƒ±sƒ± test edilmeli")
        }

        return recommendations
    }
}
```

## **5. SecurityTestSuite - Test √ñrnekleri**

### **5.1 Unit Test √ñrneƒüi**

```kotlin
class SecurityManagerTest {

    private lateinit var context: Context
    private lateinit var authManager: AuthenticationManager
    private lateinit var secureStorage: SecureStorageManager

    @Before
    fun setup() {
        context = ApplicationProvider.getApplicationContext()
        authManager = AuthenticationManager(context)
        secureStorage = SecureStorageManager(context)
    }

    @Test
    fun testSecureDataStorage() = runBlocking {
        val testKey = "test_key"
        val testData = "sensitive_test_data"

        // Veriyi g√ºvenli ≈üekilde sakla
        secureStorage.storeSecureData(testKey, testData)

        // Veriyi geri al
        val retrieved = secureStorage.getSecureData(testKey)

        // Kontrol et
        assertEquals("G√ºvenli veri alma ba≈üarƒ±sƒ±z", testData, retrieved)

        // Temizlik
        secureStorage.removeSecureData(testKey)
    }

    @Test
    fun testEncryption() {
        val originalText = "This is a secret message"

        // ≈ûifrele
        val encrypted = SecurityUtils.encryptString(originalText)

        // √á√∂z
        val decrypted = SecurityUtils.decryptString(encrypted)

        // Orijinal metin ile kar≈üƒ±la≈ütƒ±r
        assertEquals("≈ûifreleme/√ß√∂zme testi ba≈üarƒ±sƒ±z", originalText, decrypted)

        // Her ≈üifrelemenin farklƒ± olduƒüunu kontrol et
        val encrypted2 = SecurityUtils.encryptString(originalText)
        assertNotEquals("≈ûifreleme deterministik olmamalƒ±", encrypted, encrypted2)
    }

    @Test
    fun testInputValidation() {
        // Ge√ßerli email'ler
        assertTrue(SecurityUtils.InputValidator.isValidEmail("test@example.com"))
        assertTrue(SecurityUtils.InputValidator.isValidEmail("user.name@domain.co.uk"))

        // Ge√ßersiz email'ler
        assertFalse(SecurityUtils.InputValidator.isValidEmail("invalid-email"))
        assertFalse(SecurityUtils.InputValidator.isValidEmail("@domain.com"))
    }
}
```

## **6. Pratik Entegrasyon √ñrneƒüi**

### **6.1 G√ºvenli Kullanƒ±cƒ± Oturumu**

```kotlin
class SecureSessionManager(private val context: Context) {

    private val authManager = AuthenticationManager(context)
    private val secureStorage = SecureStorageManager(context)

    suspend fun performSecureLogin(email: String, password: String): LoginResult {
        return try {
            // Input validation
            if (!SecurityUtils.InputValidator.isValidEmail(email)) {
                return LoginResult.Failure("Ge√ßersiz email")
            }

            if (!SecurityUtils.InputValidator.isStrongPassword(password)) {
                return LoginResult.Failure("Zayƒ±f ≈üifre")
            }

            // API √ßaƒürƒ±sƒ± (≈üifrelenmi≈ü)
            val networkManager = NetworkManager(context)
            val result = networkManager.loginUser(email, password)

            if (result is LoginResult.Success) {
                // Ba≈üarƒ±lƒ± giri≈ü - session ba≈ülat
                authManager.startSession()

                // Token'ƒ± g√ºvenli ≈üekilde sakla
                secureStorage.storeSecureData("auth_token", result.token)

                SecurityUtils.SecurityLogger.logSecurityEvent("User login successful")
            }

            result

        } catch (e: Exception) {
            SecurityUtils.SecurityLogger.logSecurityEvent(
                "Login failed: ${e.message}",
                SecurityUtils.SecurityLogger.SecuritySeverity.WARNING
            )
            LoginResult.Failure("Giri≈ü hatasƒ±: ${e.message}")
        }
    }

    fun isUserAuthenticated(): Boolean {
        return authManager.isSessionValid() &&
               runBlocking { secureStorage.getSecureData("auth_token") != null }
    }

    fun logout() {
        runBlocking {
            secureStorage.removeSecureData("auth_token")
        }
        authManager.endSession()
        SecurityUtils.SecurityLogger.logSecurityEvent("User logout")
    }
}
```

---

## **üöÄ Hƒ±zlƒ± Ba≈ülangƒ±√ß**

### **Adƒ±m 1: Temel G√ºvenlik Kurulumu**
```kotlin
// Application sƒ±nƒ±fƒ±nda
class StudyPlanApplication : Application() {
    override fun onCreate() {
        super.onCreate()

        // G√ºvenlik bile≈üenlerini ba≈ülat
        SecurityUtils.hashString("init") // Keystore ba≈ülatma

        // Aƒü g√ºvenliƒüi kontrol√º
        val networkSecurity = NetworkSecurityManager(this)
        val status = networkSecurity.validateNetworkSecurity()

        if (!status.isHttpsWorking) {
            Log.w("Security", "HTTPS baƒülantƒ± problemi!")
        }
    }
}
```

### **Adƒ±m 2: Ana Activity'de Authentication**
```kotlin
class MainActivity : ComponentActivity() {
    private lateinit var authManager: AuthenticationManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        authManager = AuthenticationManager(this)

        // Kullanƒ±cƒ± giri≈ü yapmƒ±≈ü mƒ± kontrol et
        if (!authManager.isSessionValid()) {
            showAuthenticationScreen()
            return
        }

        // Ana uygulama i√ßeriƒüi
        setContent {
            StudyPlanApp()
        }
    }
}
```

Bu kullanƒ±m kƒ±lavuzu, g√ºvenlik bile≈üenlerinin etkin ve g√ºvenli ≈üekilde kullanƒ±lmasƒ±nƒ± saƒülar. Her bile≈üen detaylƒ± √∂rneklerle birlikte sunulmu≈ütur.